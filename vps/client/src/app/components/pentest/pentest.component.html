<div class="pentest-container">
  <h1>Penetration Test Management</h1>

  <!-- Messages -->
  <div *ngIf="error" class="alert alert-error">
    {{ error }}
    <button (click)="clearMessages()" class="close-btn">×</button>
  </div>
  <div *ngIf="success" class="alert alert-success">
    {{ success }}
    <button (click)="clearMessages()" class="close-btn">×</button>
  </div>

  <!-- PCAP Analysis Section -->
  <section class="section">
    <h2>PCAP Analysis</h2>
    <div class="form-group">
      <label for="pcapFile">PCAP File Path:</label>
      <input 
        type="text" 
        id="pcapFile" 
        [(ngModel)]="pcapFile" 
        placeholder="e.g., ./lab/captures/capture_20240101_120000.pcap"
        class="form-control"
      />
      <button (click)="analyzePcap()" [disabled]="loading || !pcapFile" class="btn btn-primary">
        {{ loading ? 'Analyzing...' : 'Analyze PCAP' }}
      </button>
    </div>
  </section>

  <!-- Findings Section -->
  <section class="section">
    <h2>Vulnerability Findings</h2>
    <div *ngIf="loading && findings.length === 0" class="loading">Loading findings...</div>
    <div *ngIf="!loading && findings.length === 0" class="empty-state">
      No findings available. Analyze a PCAP file to generate findings.
    </div>
    <div *ngIf="findings.length > 0" class="findings-list">
      <div *ngFor="let finding of findings" class="finding-card" (click)="selectFinding(finding)">
        <h3>{{ finding.finding_type || 'Unknown Finding' }}</h3>
        <p><strong>Target:</strong> {{ finding.target || 'N/A' }}</p>
        <p><strong>Severity:</strong> 
          <span class="severity severity-{{ finding.severity || 'low' }}">
            {{ (finding.severity || 'low').toUpperCase() }}
          </span>
        </p>
        <p><strong>Description:</strong> {{ finding.description || 'No description' }}</p>
        <button (click)="generateRule(finding); $event.stopPropagation()" class="btn btn-sm btn-primary">
          Generate Rule
        </button>
      </div>
    </div>
  </section>

  <!-- Selected Finding Details -->
  <section *ngIf="selectedFinding" class="section">
    <h2>Finding Details</h2>
    <div class="finding-details">
      <pre>{{ selectedFinding | json }}</pre>
      <button (click)="generateRule(selectedFinding)" class="btn btn-primary">
        Generate Rule from This Finding
      </button>
    </div>
  </section>

  <!-- Rules Management Section -->
  <section class="section">
    <h2>IDPS Rules</h2>
    <div *ngIf="loading && rules.length === 0" class="loading">Loading rules...</div>
    <div *ngIf="!loading && rules.length === 0" class="empty-state">
      No custom rules available. Generate rules from findings.
    </div>
    <div *ngIf="rules.length > 0" class="rules-list">
      <table class="rules-table">
        <thead>
          <tr>
            <th>Rule File</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let rule of rules">
            <td>{{ rule }}</td>
            <td>
              <span class="badge badge-info">Custom</span>
            </td>
            <td>
              <button (click)="activateRule(rule)" class="btn btn-sm btn-success">
                Activate
              </button>
              <button (click)="deactivateRule(rule)" class="btn btn-sm btn-warning">
                Deactivate
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>
</div>
